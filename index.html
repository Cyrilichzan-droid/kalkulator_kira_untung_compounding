<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Keuntungan Tahunan</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for Inter font -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#059669', // Emerald 600
                        'secondary': '#facc15', // Amber 400
                        'background': '#f3f4f6', // Gray 100
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* Custom styles for the language toggle switch */
        /* Move slider to the right when checkbox is checked (EN mode) */
        #lang-switch:checked + label #slider {
            transform: translateX(100%);
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-4xl space-y-8">
        <header class="text-center relative">
            <!-- Language Toggle Switch (Width: w-24, Height: h-8, Font: text-xs) -->
            <div class="absolute top-0 right-0 w-24 h-8">
                <input type="checkbox" id="lang-switch" class="hidden" onchange="toggleLanguage()">
                <label for="lang-switch" class="relative block w-full h-full bg-primary rounded-full cursor-pointer transition duration-300">
                    <!-- Sliding Indicator -->
                    <div id="slider" class="absolute top-0 left-0 w-1/2 h-full bg-white rounded-full shadow-md transform transition-transform duration-300 ease-in-out"></div>
                    <!-- Text Labels -->
                    <div class="absolute inset-0 flex items-center justify-start text-xs font-bold pointer-events-none">
                        <span id="label-ms" class="w-1/2 text-center z-10 transition duration-150">MS</span>
                        <span id="label-en" class="w-1/2 text-center z-10 transition duration-150">EN</span>
                    </div>
                </label>
            </div>
            
            <h1 class="text-4xl font-extrabold text-primary mb-2" id="headerTitle">Kalkulator Keuntungan Fleksibel</h1>
            <p class="text-gray-600 text-lg" id="headerSubtitle">Kira pulangan berdasarkan kadar yang fleksibel untuk tempoh masa yang anda pilih.</p>
        </header>

        <main class="flex justify-center">
            <!-- Combined Calculator Card -->
            <div id="annual-profit-calculator" class="card bg-white p-8 rounded-xl border-t-8 border-primary w-full max-w-lg">
                <h2 class="text-3xl font-bold text-primary mb-6 text-center" id="cardTitle">
                    Pengiraan Keuntungan
                </h2>
                
                <div class="space-y-6">
                    <!-- Input 1: Modal Awal -->
                    <div>
                        <label for="principal" class="block text-sm font-medium text-gray-700" id="labelPrincipal">Modal Awal (RM)</label>
                        <input type="number" id="principal" value="1000" min="0" step="100" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-primary focus:ring-primary" oninput="calculateAll()">
                    </div>
                    
                    <!-- Pilihan Jenis Keuntungan -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="labelCalcType">Pilih Cara Kira Keuntungan</label>
                        <div class="flex space-x-6 bg-gray-50 p-3 rounded-lg">
                            <!-- Radio 1: Percentage -->
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="profitType" value="percentage" checked onclick="toggleCalculationType()" class="form-radio text-primary h-4 w-4 border-gray-300 focus:ring-primary">
                                <span class="ml-2 text-gray-700 font-medium" id="radioPercentage">Peratusan (%)</span>
                            </label>
                            <!-- Radio 2: Fixed Amount -->
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="profitType" value="fixed" onclick="toggleCalculationType()" class="form-radio text-primary h-4 w-4 border-gray-300 focus:ring-primary">
                                <span class="ml-2 text-gray-700 font-medium" id="radioFixed">Jumlah Tetap (RM)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Input Group 2: Percentage (Compounding) -->
                    <div id="percentageInputGroup">
                        <label class="block text-sm font-medium text-gray-700" id="labelRate">Peratus Keuntungan (%)</label>
                        <div class="flex space-x-4 mt-1">
                            <div class="flex-grow">
                                <label for="rate" class="sr-only">Peratus</label>
                                <input type="number" id="rate" value="7" min="0.01" max="100" step="0.1" class="block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-primary focus:ring-primary" oninput="calculateAll()" placeholder="Peratus">
                            </div>
                            <div>
                                <label for="rateFrequency" class="sr-only">Kekerapan</label>
                                <select id="rateFrequency" onchange="calculateAll()" class="block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-primary focus:ring-primary">
                                    <option value="day" id="rateFreqDay">Sehari</option>
                                    <option value="week" selected id="rateFreqWeek">Seminggu</option>
                                    <option value="month" id="rateFreqMonth">Sebulan</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Input Group 3: Fixed Amount -->
                    <div id="fixedAmountInputGroup" class="hidden">
                        <label class="block text-sm font-medium text-gray-700" id="labelFixedAmount">Keuntungan Tetap (RM)</label>
                        <div class="flex space-x-4 mt-1">
                            <div class="flex-grow">
                                <label for="fixedAmount" class="sr-only">Jumlah (RM)</label>
                                <input type="number" id="fixedAmount" value="500" min="0" step="10" class="block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-primary focus:ring-primary" oninput="calculateAll()" placeholder="Jumlah (RM)">
                            </div>
                            <div>
                                <label for="fixedFrequency" class="sr-only">Kekerapan</label>
                                <select id="fixedFrequency" onchange="calculateAll()" class="block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-primary focus:ring-primary">
                                    <option value="day" id="fixedFreqDay">Sehari</option>
                                    <option value="week" selected id="fixedFreqWeek">Seminggu</option>
                                    <option value="month" id="fixedFreqMonth">Sebulan</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Input Group 4: Duration -->
                    <div class="border-t pt-6 mt-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4" id="titleDuration">Tempoh Pengiraan</h3>
                        <div class="flex space-x-4">
                            <div class="flex-grow">
                                <label for="durationValue" class="block text-sm font-medium text-gray-700" id="labelDurationValue">Tempoh (Nilai)</label>
                                <input type="number" id="durationValue" value="52" min="1" step="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-primary focus:ring-primary" oninput="calculateAll()">
                            </div>
                            <div>
                                <label for="durationUnit" class="block text-sm font-medium text-gray-700" id="labelDurationUnit">Unit</label>
                                <select id="durationUnit" onchange="calculateAll()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-primary focus:ring-primary">
                                    <option value="weeks" selected id="durationUnitWeeks">Minggu</option>
                                    <option value="days" id="durationUnitDays">Hari</option>
                                    <option value="months" id="durationUnitMonths">Bulan</option>
                                </select>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Results Section -->
                <div class="mt-8 pt-6 border-t border-gray-200 space-y-4">
                    <h3 class="text-xl font-semibold text-gray-800" id="titleResults">Keputusan Pengiraan</h3>
                    
                    <!-- Primary Result (Shows Profit) -->
                    <div id="primaryResultDisplay" class="p-4 bg-primary/10 rounded-lg border border-primary/20">
                        <span class="block text-sm font-medium text-primary" id="resultLabel">Keuntungan Setelah Tempoh</span>
                        <div class="font-bold text-2xl text-primary mt-1" id="annualProfitResult">RM 0.00</div>
                    </div>
                    
                    <!-- Secondary Result (Shows Total Amount - NOW ALWAYS VISIBLE) -->
                    <div id="totalAmountDisplay" class="p-4 bg-primary/10 rounded-lg border border-primary/20">
                        <span class="block text-sm font-medium text-primary" id="labelTotalAmount">Jumlah Akhir (Modal + Untung)</span>
                        <div class="font-bold text-2xl text-primary mt-1" id="totalAmountResult">RM 0.00</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Constants for conversion (assuming 52 weeks/year and average 4.333 weeks/month)
        const DAYS_PER_WEEK = 7;
        const WEEKS_PER_MONTH = 52 / 12; 
        
        let currentLang = 'ms'; // Default language (MS)

        // Translation dictionary for all static text elements
        const translations = {
            'ms': {
                headerTitle: 'Kalkulator Keuntungan Fleksibel',
                headerSubtitle: 'Kira pulangan berdasarkan kadar yang fleksibel untuk tempoh masa yang anda pilih.',
                cardTitle: 'Pengiraan Keuntungan',
                labelPrincipal: 'Modal Awal (RM)',
                labelCalcType: 'Pilih Cara Kira Keuntungan',
                radioPercentage: 'Peratusan (%)',
                radioFixed: 'Jumlah Tetap (RM)',
                labelRate: 'Peratus Keuntungan (%)',
                labelFixedAmount: 'Keuntungan Tetap (RM)',
                rateFreqDay: 'Sehari',
                rateFreqWeek: 'Seminggu',
                rateFreqMonth: 'Sebulan',
                fixedFreqDay: 'Sehari',
                fixedFreqWeek: 'Seminggu',
                fixedFreqMonth: 'Sebulan',
                titleDuration: 'Tempoh Pengiraan',
                labelDurationValue: 'Tempoh (Nilai)',
                labelDurationUnit: 'Unit',
                durationUnitDays: 'Hari',
                durationUnitWeeks: 'Minggu',
                durationUnitMonths: 'Bulan',
                titleResults: 'Keputusan Pengiraan',
                labelTotalAmount: 'Jumlah Akhir (Modal + Untung)',
                resultLabelInitial: 'Keuntungan Setelah Tempoh',
                resultLabelCompoundingSuffix: ' (Berkompaun)',
                resultLabelFixedSuffix: ' (Jumlah Tetap)',
            },
            'en': {
                headerTitle: 'Flexible Profit Calculator',
                headerSubtitle: 'Calculate returns based on flexible rates for your chosen duration.',
                cardTitle: 'Profit Calculation',
                labelPrincipal: 'Initial Capital (RM)',
                labelCalcType: 'Choose Calculation Method',
                radioPercentage: 'Percentage (%)',
                radioFixed: 'Fixed Amount (RM)',
                labelRate: 'Profit Percentage (%)',
                labelFixedAmount: 'Fixed Profit (RM)',
                rateFreqDay: 'Daily',
                rateFreqWeek: 'Weekly',
                rateFreqMonth: 'Monthly',
                fixedFreqDay: 'Daily',
                fixedFreqWeek: 'Weekly',
                fixedFreqMonth: 'Monthly',
                titleDuration: 'Calculation Period',
                labelDurationValue: 'Duration (Value)',
                labelDurationUnit: 'Unit',
                durationUnitDays: 'Days',
                durationUnitWeeks: 'Weeks',
                durationUnitMonths: 'Months',
                titleResults: 'Calculation Results',
                labelTotalAmount: 'Final Total (Capital + Profit)',
                resultLabelInitial: 'Profit After Period',
                resultLabelCompoundingSuffix: ' (Compounded)',
                resultLabelFixedSuffix: ' (Fixed Amount)',
            }
        };

        /**
         * @function toggleLanguage
         * Switches the current language between Malay and English based on the toggle switch state.
         */
        function toggleLanguage() {
            const langSwitch = document.getElementById('lang-switch');
            const labelMS = document.getElementById('label-ms');
            const labelEN = document.getElementById('label-en');

            // Determine new language based on checkbox state (checked = EN, unchecked = MS)
            currentLang = langSwitch.checked ? 'en' : 'ms';

            // Toggle Text Colors based on active language (text inside white slider is primary color)
            if (currentLang === 'en') {
                // EN is active (slider is on the right)
                labelMS.classList.remove('text-primary');
                labelMS.classList.add('text-white');
                labelEN.classList.remove('text-white');
                labelEN.classList.add('text-primary');
            } else {
                // MS is active (slider is on the left)
                labelMS.classList.remove('text-white');
                labelMS.classList.add('text-primary');
                labelEN.classList.remove('text-primary');
                labelEN.classList.add('text-white');
            }

            updateUI(currentLang);
            calculateAll();
        }

        /**
         * @function updateUI
         * Updates all text elements on the page based on the selected language.
         * @param {string} lang - The language code ('ms' or 'en').
         */
        function updateUI(lang) {
            const t = translations[lang];

            // Update simple IDs
            document.getElementById('headerTitle').textContent = t.headerTitle;
            document.getElementById('headerSubtitle').textContent = t.headerSubtitle;
            document.getElementById('cardTitle').textContent = t.cardTitle;
            document.getElementById('labelPrincipal').textContent = t.labelPrincipal;
            document.getElementById('labelCalcType').textContent = t.labelCalcType;
            document.getElementById('radioPercentage').textContent = t.radioPercentage;
            document.getElementById('radioFixed').textContent = t.radioFixed;
            document.getElementById('labelRate').textContent = t.labelRate;
            document.getElementById('labelFixedAmount').textContent = t.labelFixedAmount;
            document.getElementById('titleDuration').textContent = t.titleDuration;
            document.getElementById('labelDurationValue').textContent = t.labelDurationValue;
            document.getElementById('labelDurationUnit').textContent = t.labelDurationUnit;
            document.getElementById('titleResults').textContent = t.titleResults;
            document.getElementById('labelTotalAmount').textContent = t.labelTotalAmount;

            // Update Select Options (Rate Frequency)
            document.getElementById('rateFreqDay').textContent = t.rateFreqDay;
            document.getElementById('rateFreqWeek').textContent = t.rateFreqWeek;
            document.getElementById('rateFreqMonth').textContent = t.rateFreqMonth;

            // Update Select Options (Fixed Frequency)
            document.getElementById('fixedFreqDay').textContent = t.fixedFreqDay;
            document.getElementById('fixedFreqWeek').textContent = t.fixedFreqWeek;
            document.getElementById('fixedFreqMonth').textContent = t.fixedFreqMonth;

            // Update Select Options (Duration Unit)
            document.getElementById('durationUnitDays').textContent = t.durationUnitDays;
            document.getElementById('durationUnitWeeks').textContent = t.durationUnitWeeks;
            document.getElementById('durationUnitMonths').textContent = t.durationUnitMonths;
        }


        /**
         * @function formatCurrency
         * Formats a number into Malaysian Ringgit (RM) currency string.
         * @param {number} value - The number to format.
         * @returns {string} - Formatted currency string.
         */
        function formatCurrency(value) {
            return new Intl.NumberFormat('ms-MY', {
                style: 'currency',
                currency: 'MYR',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        /**
         * @function getCalculationPeriods
         * Converts the user-defined duration (Days, Weeks, or Months) into total weeks.
         * @returns {number} - Total number of weeks (periods) for calculation.
         */
        function getCalculationPeriods() {
            const durationValue = parseFloat(document.getElementById('durationValue').value) || 0;
            const durationUnit = document.getElementById('durationUnit').value;

            if (durationValue <= 0) return 0;

            let totalWeeks = 0;

            switch (durationUnit) {
                case 'days':
                    totalWeeks = durationValue / DAYS_PER_WEEK;
                    break;
                case 'weeks':
                    totalWeeks = durationValue;
                    break;
                case 'months':
                    totalWeeks = durationValue * WEEKS_PER_MONTH;
                    break;
                default:
                    totalWeeks = 0;
            }
            // Use Math.max(0, ...) to prevent negative periods if input is somehow negative
            return Math.max(0, totalWeeks);
        }

        /**
         * @function toggleCalculationType
         * Hides/shows the relevant input group (Rate or Fixed Amount) based on radio button selection.
         * Total Amount Display is now ALWAYS visible.
         */
        function toggleCalculationType() {
            const type = document.querySelector('input[name="profitType"]:checked').value;
            const percentageGroup = document.getElementById('percentageInputGroup');
            const fixedGroup = document.getElementById('fixedAmountInputGroup');
            
            // Note: totalAmountDisplay is no longer toggled as hidden/shown; it is always visible.
            
            if (type === 'percentage') {
                percentageGroup.classList.remove('hidden');
                fixedGroup.classList.add('hidden');
            } else { // type === 'fixed'
                percentageGroup.classList.add('hidden');
                fixedGroup.classList.remove('hidden');
            }
            calculateAll(); // Recalculate immediately
        }

        /**
         * @function calculateAll
         * Calculates annual profit and total amount based on the selected type and duration.
         */
        function calculateAll() {
            const t = translations[currentLang];
            const type = document.querySelector('input[name="profitType"]:checked').value;
            const principal = parseFloat(document.getElementById('principal').value) || 0;
            
            // Get calculation period in weeks
            const totalWeeks = getCalculationPeriods();

            const annualProfitResult = document.getElementById('annualProfitResult');
            const totalAmountResult = document.getElementById('totalAmountResult');
            const resultLabel = document.getElementById('resultLabel');
            
            // Get selected duration unit text (in current language)
            const durationValue = document.getElementById('durationValue').value;
            const durationUnitElement = document.getElementById('durationUnit').options[document.getElementById('durationUnit').selectedIndex];
            const durationUnitKey = 'durationUnit' + durationUnitElement.value.charAt(0).toUpperCase() + durationUnitElement.value.slice(1);
            const durationUnitText = t[durationUnitKey]; 

            let newLabel = `${t.resultLabelInitial} ${durationValue} ${durationUnitText}`;

            let profit = 0;
            let totalAmount = principal;

            if (type === 'percentage') {
                newLabel += t.resultLabelCompoundingSuffix;
                const ratePercent = parseFloat(document.getElementById('rate').value) || 0;
                const rateFrequency = document.getElementById('rateFrequency').value; // Get percentage frequency
                
                let ratePerWeek = 0; // Effective weekly rate (in decimal)

                if (ratePercent > 0) {
                    // Convert percentage to decimal rate
                    const rateDecimal = ratePercent / 100;
                    
                    // 1. Convert input rate to effective weekly compounding rate
                    if (rateFrequency === 'day') {
                        // Effective weekly rate if compounded daily: (1 + r_daily)^7 - 1
                        ratePerWeek = Math.pow(1 + rateDecimal, DAYS_PER_WEEK) - 1;
                    } else if (rateFrequency === 'week') {
                        // Input rate is already weekly
                        ratePerWeek = rateDecimal;
                    } else if (rateFrequency === 'month') {
                        // Effective weekly rate if compounded monthly: (1 + r_monthly)^(1/WEEKS_PER_MONTH) - 1
                        // This is the Equivalent periodic rate calculation
                        ratePerWeek = Math.pow(1 + rateDecimal, 1 / WEEKS_PER_MONTH) - 1;
                    }
                }
                
                if (principal > 0 && ratePerWeek > 0 && totalWeeks > 0) {
                    // Compound Interest Formula: A = P * (1 + r_weekly)^totalWeeks
                    totalAmount = principal * Math.pow(1 + ratePerWeek, totalWeeks);
                    profit = totalAmount - principal;
                } else {
                    totalAmount = principal;
                    profit = 0;
                }

            } else { // type === 'fixed'
                newLabel += t.resultLabelFixedSuffix;
                const fixedAmount = parseFloat(document.getElementById('fixedAmount').value) || 0;
                const fixedFrequency = document.getElementById('fixedFrequency').value; // Get fixed profit frequency

                let weeklyFixedProfit = 0;

                // Convert fixed profit to actual weekly rate
                if (fixedFrequency === 'day') {
                    weeklyFixedProfit = fixedAmount * DAYS_PER_WEEK;
                } else if (fixedFrequency === 'week') {
                    weeklyFixedProfit = fixedAmount;
                } else if (fixedFrequency === 'month') {
                    // Calculate weekly profit from monthly profit
                    weeklyFixedProfit = fixedAmount / WEEKS_PER_MONTH; 
                }
                
                // Profit Calculation: Profit = Actual Weekly Profit * totalWeeks
                if (fixedAmount >= 0 && totalWeeks > 0) {
                    profit = weeklyFixedProfit * totalWeeks;
                    totalAmount = principal + profit; // Calculate total amount
                } else {
                    profit = 0;
                    totalAmount = principal;
                }
            }

            resultLabel.textContent = newLabel;
            annualProfitResult.textContent = formatCurrency(profit);
            totalAmountResult.textContent = formatCurrency(totalAmount);
        }

        // Start calculation and update UI when the page loads
        window.onload = () => {
            // Set initial calculation type
            toggleCalculationType();
            
            // Set initial language UI (MS default). The checkbox is unchecked, so currentLang='ms'.
            const langSwitch = document.getElementById('lang-switch');
            langSwitch.checked = false; 
            toggleLanguage(); // Call this to set the initial state colors and labels
        };

    </script>
</body>
</html>
